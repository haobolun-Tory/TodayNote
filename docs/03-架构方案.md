# TodayNote 博客系统（MVP）架构方案

## 1. 总体架构
采用最简单可落地的 **前后端分离 + 单体后端**：
- 前端：Vue 3 SPA（Vite 构建），通过 REST API 调用后端
- 后端：Spring Boot（Java 21）提供 REST API
- 数据库：本地 MySQL

MVP 不引入微服务、不引入消息队列、不引入分布式缓存。

## 2. 架构视图

### 2.1 逻辑视图
- Web UI（浏览/写作/管理）
- API（认证、文章、标签、用户）
- 数据层（MyBatis-Plus + MySQL）

### 2.2 分层架构（后端）
- **Controller 层**：HTTP、DTO、校验、鉴权注解/拦截
- **Service 层**：业务规则与事务
- **Repository/Mapper 层**：CRUD 与查询
- **Domain/Entity 层**：实体与枚举

### 2.3 前端结构（建议）
- `src/pages`：页面
- `src/components`：可复用组件
- `src/stores`：Pinia
- `src/api`：Axios 封装
- `src/router`：路由

## 3. 关键技术决策

### 3.1 认证与会话
- 方案：JWT（Bearer Token）
- 机制：
  - 登录成功签发 token
  - 前端每次请求携带 `Authorization: Bearer <token>`
  - 后端过滤器解析 token，注入当前用户上下文

为什么不选 Session：MVP 也可用，但前后端分离时 JWT 更直观，且未来扩展更方便。

### 3.2 内容存储与渲染
- 内容以 Markdown 存储在数据库字段 `content_md`
- 渲染策略（MVP 选其一）：
  1) **前端渲染**（推荐）：后端返回 Markdown，前端用 `markdown-it` 渲染；注意开启 XSS 防护
  2) 后端渲染：保存 `content_html`，前端直接展示；需要后端做安全过滤

为了简单与可控，MVP 推荐“前端渲染 + 严格 XSS 策略”。

### 3.3 搜索
- MVP：MySQL `LIKE`（标题/摘要）
- 后续：ES（全文检索）

## 4. 部署方案（本地开发）

### 4.1 运行单元
- MySQL：本地服务或 Docker 容器
- 后端：`mvn spring-boot:run`
- 前端：`pnpm dev` / `npm run dev`

### 4.2 配置
- 后端 `application-dev.properties` 配置：
  - `spring.datasource.url`
  - `spring.datasource.username/password`
  - MyBatis-Plus 配置

建议把 JWT 密钥通过环境变量注入（MVP 也可先写在 dev 配置里）。

## 5. 可扩展演进（不影响 MVP 的前提下）
- 评论、点赞、收藏
- 管理端：文章下架/封禁用户
- 对象存储：图片上传（OSS/MinIO）
- 缓存：Redis（热门文章/标签）
- 搜索：Elasticsearch
- 观测：日志规范 + TraceId

## 6. 风险与约束
- Markdown 渲染的 XSS 风险：必须明确渲染策略与白名单
- JWT 过期与刷新：MVP 可先短期 token；后续引入 refresh token
- 数据库索引：文章列表与搜索在数据量上来后需要优化

